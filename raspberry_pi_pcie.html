<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="assets/portal.ico">
  <title>Raspberry Pi -- Homelab | Hylown</title>
  <link rel="stylesheet" href="assets/css/hylowncom.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>
<body>

  <header class="header top-bar">
    <div class="wrapper no-pad">
      <ul class="navigation">
        <li class="hamburger-icon"><a href="javascript:void(0)" onclick="toggleNav()"><span>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span></a></li>
        <li style="padding:0;"><a style="padding:0;margin:0 10;" href="https://hylown.com"><img src="assets/portal.png" width="31px" height="31px"></a></li>
        <li><a href="homelab.html">Homelab</a></li>
        <li><a href="apps.html">Apps</a></li>
        <li><a href="consulting.html">Consulting</a></li>
        <li><a style="font-size:1.5em;" href=""><i class="bi bi-linkedin"></i></a></li>
        <li><a style="font-size:1.5em;" href="https://github.com/BStew00/hylowncom_site"><i class="bi bi-github"></i></a></li>
        <li><a href="buy_us_a_coffee.html">Support Us</a></li>
      </ul>
    </div>
  </header>

  <div class="container">
    <main class="main">
        <div class="main__inner grid">
            <div class="sidebar sidebar--primary" id="sidebar--primary">
                <div class="sidebar__scrollwrap">
                    <div class="sidebar__inner sidebar__inner-left">
                      <div>
                        <label>Homelab</label>
                        <a href="javascript:void(0)" class="closebtn" id="closebtn" onclick="toggleNav()" style="display:none;">&times;</a>
                      </div>
                      <ul class="side-nav">
                        <li><a id="Home" href="homelab.html">Home</a></li>
                        <li><a id="SSH" href="ssh.html">SSH</a></li>
                        <li><a id="RaspberryPi" href="raspberry_pi.html">Raspberry Pi</a>
                          <ul class="side-nav side-nav-2">
                            <li><a id="RaspberryPi-Initialize" href="raspberry_pi_initialize.html">Initialize</a></li>
                            <li><a id="RaspberryPi-PCIE" href="raspberry_pi_pcie.html">PCIe Boot NVMe</a></li>
                            <li><a id="Extras" href="raspberry_pi_extras.html">Extras</a></li>
                          </ul>
                        </li>
                        <li><a id="LocalHTTPServer" href="local_http_server.html">Local HTTP Server</a></li>
                        <li><a id="LocalGitServer" href="local_git_server.html">Local Git Server</a></li>
                        <li><a id="RemoteGitServer" href="remote_git_server.html">Remote Git Server</a></li>
                      </ul>
                    </div>
                </div>
            </div>
            <div class="sidebar sidebar--secondary" style="top:48px;">
                <div class="sidebar__scrollwrap">
                    <div class="sidebar__inner">
                      <div>
                        <label>On this page</label>
                      </div>
                      <ul class="side-nav template__nav" id="right-nav">
                        <li><a href="">back to top</a></li>
                        <li class="template__nav-item"><a href="#enable-pcie">Enable PCIe</a></li>
<li class="template__nav-item"><a href="#put-os-on-nvme-gui">Put OS on NVMe -- GUI</a></li>
<li class="template__nav-item"><a href="#put-os-on-nvme-cli">Put OS on NVMe -- CLI</a></li>
<li class="template__nav-item"><a href="#set-boot-priority">Set boot priority</a></li>
                      </ul>
                    </div>
                </div>
            </div>
            <div class="content">
              <article>
                <a class="source-button" href="https://github.com/BStew00/hylowncom_site" title="Edit this page"><svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg></a>
                <a class="source-button" href="raspberry_pi_pcie.md" title="View source of this page"><svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg></a>
                <br>
                <h1 id="setting-up-a-raspberry-pi-to-boot-from-pcie">Setting up a Raspberry Pi to boot from PCIe</h1>
<h2 class="template__section" id="enable-pcie">Enable PCIe</h2>
<p>If using the official Raspberry Pi PCIe-to-M.2 Hat+, it should be automatically detected. </p>
<p>For other PCIe Hats, enable PCIe by editing </p>
<pre><code>/boot/firmware/config.txt
</code></pre>
<p>by adding </p>
<pre><code>dtparam=pciex1
</code></pre>
<p>to the end of the file (should be under section <code>[all]</code>).</p>
<p>Save and reboot.</p>
<h2 class="template__section" id="put-os-on-nvme-gui">Put OS on NVMe &ndash; GUI</h2>
<p>Run</p>
<pre><code class="language-bash">$ lsblk
</code></pre>
<p>to see if the drive is detected; if not enable PCIe as per above.</p>
<p>If connected to a monitor, you can copy the OS image from the micro SD card to the NVMe using either the &ldquo;SD Card Copier&rdquo; software or the Raspberry Pi Imager, both of which are packaged with the OS.  </p>
<p>To use the SD Card Copier: </p>
<pre><code>&gt;&gt; Raspberry Pi icon 
&gt;&gt; Accessories 
&gt;&gt; SD Card Copier 
&gt;&gt; select the two appropriate disks 
&gt;&gt; click Start
</code></pre>
<h2 class="template__section" id="put-os-on-nvme-cli">Put OS on NVMe &ndash; CLI</h2>
<p>To install a bootable OS image to an NVMe drive, first get an OS image file from <a href="https://downloads.raspberrypi.com">downloads.raspberrypi.com</a>:</p>
<pre><code class="language-bash">$ wget https://downloads.raspberrypi.com/raspios_arm64/images/raspios_arm64-2025-05-13/2025-05-13-raspios-bookworm-arm64.img.xz
</code></pre>
<p>and update the machine&rsquo;s software/firmware by running the following commands:</p>
<pre><code class="language-bash">$ sudo apt update &amp;&amp; sudo apt full-upgrade
$ sudo reboot
$ sudo rpi-update
$ sudo reboot
$ sudo rpi-eeprom-update
</code></pre>
<p>Note that <code>rpi-update</code> updates the firmware and kernel; if it causes problems, it can be reverted using:</p>
<pre><code class="language-bash">$ sudo apt update
$ sudo apt install --reinstall raspi-firmware
</code></pre>
<p>This is a &ldquo;go back&rdquo; saftey feature built in by the Raspberry Pi developers.</p>
<p>Note that <code>rpi-eeprom-update</code> updates the bootloader firmware; if you receive an eeprom error, it can be reverted by running:</p>
<pre><code class="language-bash">$ sudo raspi-config
</code></pre>
<p>and making the configuration:</p>
<pre><code>&gt;&gt; Advanced Options 
&gt;&gt; Bootloader Version 
&gt;&gt; select latest
</code></pre>
<p>and reboot.</p>
<p>Next, get the <code>firstboot.sh</code> file that we saved in the section <a href="raspberry_pi_initialize.html">Initialize</a> to the Raspberry Pi using:</p>
<pre><code class="language-bash">$ scp /path/on/other/machine/firstboot.sh /path/on/RPi/firstboot.sh
</code></pre>
<p>In the directory where you just put this file, run</p>
<pre><code class="language-bash">$ ls -l
</code></pre>
<p>to check that the file has executable permission; if not, run</p>
<pre><code class="language-bash">$ chmod +x firstboot.sh
</code></pre>
<p>Finally, we use the Raspberry Pi Imager from the command line to install the OS on the NVMe drive:</p>
<pre><code class="language-bash">$ sudo rpi-imager --cli --first-run-script ./firstboot.sh 2025-05-13-raspios-bookworm-arm64.img.xz /dev/nvme0n1
</code></pre>
<p>You should now be able to boot the Raspberry Pi from the NVMe.  </p>
<p>You can always run</p>
<pre><code>$ df /boot -h
</code></pre>
<p>to see what is the boot drive.</p>
<p>Run</p>
<pre><code class="language-bash">$ sudo shutdown -h now
</code></pre>
<p>to turn off the Raspberry Pi.</p>
<p>Remove the power cord.</p>
<p>Remove the micro SD card</p>
<p>Reboot.</p>
<h2 class="template__section" id="set-boot-priority">Set boot priority</h2>
<p>The Raspberry Pi&rsquo;s default boot order will boot from a bootable NVMe drive if no other drive is found. But it will probably boot quicker after setting the boot order as follows:</p>
<pre><code class="language-bash">$ sudo raspi-config
</code></pre>
<pre><code class="language-bash">&gt;&gt; Advanced Options 
&gt;&gt; Boot Order 
&gt;&gt; B2 NVMe/USB Boot from NVMe before trying ...
</code></pre>
<p>Reboot.</p>
                <p class="outro">To suggest an edit or correction to this page, please click the "Edit this page" button below or at the top to access the source file on GitHub.</p>
                <br>
                <div class="source-button-bottom">
                  <div class="source-button-bottom-inner">
                    <a id="a" class="source-button" href="raspberry_pi_pcie.md" title="View source of this page"><svg xmlns="http://www.w3.org/2000/svg" width="50px" height="50px" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg></a>
                    <label id="b">View</label>
                  </div>
                  <div class="source-button-bottom-inner">
                    <a id="c" class="source-button" href="https://github.com/BStew00/hylowncom_site" title="Edit this page"><svg xmlns="http://www.w3.org/2000/svg" width="50px" height="50px" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg></a>
                    <label id="d">Edit</label>
                  </div>
                </div>
              </article>
            </div>
        </div>
    </main>
    <footer class="footer">
      <!--<div><p>All content copyright Hylown</p></div>-->
      <div><a href="tou.html">Terms of Use</a></div>
      <div><a href="https://hylown.com"><img src="assets/portal.png" width="100px" height="100px"></a></div>
      <div><a href="">back to top</a></div>
    </footer>
  </div>
  <script>
    document.getElementById('RaspberryPi-PCIE').classList.add('active')
  </script>
  <script src="assets/javascript/hylowncom.js"></script>
</body>
</html>